{"version":3,"sources":["../../../../src/server/lib/incremental-cache/index.ts"],"names":["FetchCache","FileSystemCache","encodeText","encode","normalizePagePath","CACHE_ONE_YEAR","NEXT_CACHE_REVALIDATED_TAGS_HEADER","NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER","PRERENDER_REVALIDATE_HEADER","toRoute","SharedRevalidateTimings","CacheHandler","constructor","_ctx","get","_args","set","revalidateTag","_tag","IncrementalCache","fs","dev","appDir","flushToDisk","fetchCache","minimalMode","serverDistDir","requestHeaders","requestProtocol","maxMemoryCacheSize","getPrerenderManifest","fetchCacheKeyPrefix","CurCacheHandler","allowedRevalidateHeaderKeys","locks","Map","unlocks","debug","process","env","NEXT_PRIVATE_DEBUG_CACHE","console","log","isAvailable","_requestHeaders","name","__NEXT_TEST_MAX_ISR_CACHE","parseInt","minimalModeKey","prerenderManifest","revalidateTimings","revalidatedTags","preview","previewModeId","isOnDemandRevalidate","split","cacheHandler","_appDir","calculateRevalidate","pathname","fromTime","Date","getTime","initialRevalidateSeconds","revalidateAfter","_getPathname","unlock","cacheKey","delete","lock","__NEXT_INCREMENTAL_CACHE_IPC_PORT","__NEXT_INCREMENTAL_CACHE_IPC_KEY","NEXT_RUNTIME","invokeIpcMethod","require","method","ipcPort","ipcKey","args","unlockNext","Promise","resolve","existingLock","newLock","tag","arguments","fetchCacheKey","url","init","MAIN_KEY_PREFIX","bodyChunks","body","getReader","readableBody","reader","arrayBuffer","Uint8Array","processValue","done","value","push","curBuffer","prevBuffer","byteLength","err","error","read","then","_ogBody","keys","formData","key","Set","values","getAll","all","map","val","text","join","blob","Blob","type","cacheString","JSON","stringify","headers","Object","fromEntries","mode","redirect","credentials","referrer","referrerPolicy","integrity","cache","bufferToHex","buffer","Array","prototype","call","b","toString","padStart","crypto","subtle","digest","createHash","update","ctx","cacheData","entry","revalidate","kind","combinedTags","tags","softTags","some","includes","age","Math","round","now","lastModified","isStale","data","curRevalidate","undefined","notFoundRoutes","length","Error","warn"],"mappings":"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"}