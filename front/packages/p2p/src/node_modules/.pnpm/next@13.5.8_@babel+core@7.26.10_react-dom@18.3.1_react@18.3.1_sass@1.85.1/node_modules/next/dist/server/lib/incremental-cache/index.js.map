{"version":3,"sources":["../../../../src/server/lib/incremental-cache/index.ts"],"names":["CacheHandler","IncrementalCache","constructor","_ctx","get","_args","set","revalidateTag","_tag","fs","dev","appDir","flushToDisk","fetchCache","minimalMode","serverDistDir","requestHeaders","requestProtocol","maxMemoryCacheSize","getPrerenderManifest","fetchCacheKeyPrefix","CurCacheHandler","allowedRevalidateHeaderKeys","locks","Map","unlocks","debug","process","env","NEXT_PRIVATE_DEBUG_CACHE","console","log","FileSystemCache","FetchCache","isAvailable","_requestHeaders","name","__NEXT_TEST_MAX_ISR_CACHE","parseInt","minimalModeKey","prerenderManifest","revalidateTimings","SharedRevalidateTimings","revalidatedTags","PRERENDER_REVALIDATE_HEADER","preview","previewModeId","isOnDemandRevalidate","NEXT_CACHE_REVALIDATED_TAGS_HEADER","NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER","split","cacheHandler","_appDir","calculateRevalidate","pathname","fromTime","Date","getTime","initialRevalidateSeconds","toRoute","revalidateAfter","_getPathname","normalizePagePath","unlock","cacheKey","delete","lock","__NEXT_INCREMENTAL_CACHE_IPC_PORT","__NEXT_INCREMENTAL_CACHE_IPC_KEY","NEXT_RUNTIME","invokeIpcMethod","require","method","ipcPort","ipcKey","args","unlockNext","Promise","resolve","existingLock","newLock","tag","arguments","fetchCacheKey","url","init","MAIN_KEY_PREFIX","bodyChunks","body","getReader","readableBody","reader","arrayBuffer","Uint8Array","processValue","done","value","push","encode","curBuffer","encodeText","prevBuffer","byteLength","err","error","read","then","_ogBody","keys","formData","key","Set","values","getAll","all","map","val","text","join","blob","Blob","type","cacheString","JSON","stringify","headers","Object","fromEntries","mode","redirect","credentials","referrer","referrerPolicy","integrity","cache","bufferToHex","buffer","Array","prototype","call","b","toString","padStart","crypto","subtle","digest","createHash","update","ctx","cacheData","entry","revalidate","kind","combinedTags","tags","softTags","some","includes","age","Math","round","now","lastModified","isStale","data","curRevalidate","CACHE_ONE_YEAR","undefined","notFoundRoutes","length","Error","warn"],"mappings":"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"}